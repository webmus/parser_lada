# parser_lada

## Объяснение распространённой ошибки движка Lada

Если сайт выводит сообщение вида:

```
Fatal error: Uncaught Error: Call to undefined function lada_import_html_fragment()
```

это означает, что в процессе выполнения PHP-скрипта был вызван метод `lada_import_html_fragment()`,
но интерпретатор не нашёл его определения. Как правило, функция определена внутри одного из файлов
ядра системы управления сайтом или в плагине. Ошибка возникает в двух типичных ситуациях:

1. **Отсутствует подключение нужного файла.** Скрипт, который пользуется функцией, должен подключить
   PHP-файл с её определением (через `require`, `include` и т. п.). Если файл не подключён, функция
   остаётся неопределённой.
2. **Файл был удалён или не загружен на сервер.** Даже при корректном подключении функция не появится,
   если физически отсутствует файл, в котором она объявлена.

Чтобы помочь исправить проблему, важно предоставить:

- полный список файлов, относящихся к кастомным или сторонним плагинам, которые используют функцию;
- содержимое файла, где функция должна объявляться (обычно это один из файлов ядра Lada CMS);
- структуру `engine/cache/system/plugins/` и исходный код плагина, который вызывает функцию;
- журналы или историю последних изменений сайта (удаление/обновление плагинов, обновление CMS);
- версию CMS и набор установленных модулей.

Эта информация позволит определить, какой файл обязан объявлять `lada_import_html_fragment()` и
почему он не подключается в текущей конфигурации.

## Диагностика этапов парсинга

Плагин формирует журналы в каталоге `logs/` и теперь, помимо обычных записей, оставляет пометки вида
`[STAGE:...]` для ключевых шагов:

* `LIST_*` — сбор ссылок (`LIST_START`, `LIST_MODULE_START`, `LIST_MODULE_DONE`, `LIST_END`).
* `NEWS_*` — загрузка и подготовка статей из очереди (`NEWS_START`, `NEWS_ITEM_START`, `NEWS_ITEM_DONE`, `NEWS_END`).
* `ADD_*` — добавление новости в базу (`ADD_CALL`, `ADD_BEFORE_INSERT`, `ADD_SUCCESS`, `ADD_SKIPPED`).
* `REWRITE_*` — работа с GPT и обновление материала (`REWRITE_START`, `REWRITE_DONE`).
* `POST_SEND` — автоматическая отправка после публикации.

По времени появления записей легко понять, на каком этапе процесс остановился или завершился с ошибкой.

